<%- include('header') %>
    <div class="main-panel">
        <div class="contentright w-auto">
            <div class="container-fluid mt-3">
                <div class="row">
                    <div class="col-md-12">
                        <div class="d-flex">
                            <div class="tableheading ">
                                <h3>Terms & Conditions</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <% const contentData = fetchData ? fetchData.page_content : ""; %>
                <div class="row">
                    <div class="col-md-12 grid-margin stretch-card">
                        <div class="card position-relative">
                            <div class="card-body">
                                <form class="forms-sample" method="get" action="edit-terms-and-conditions"
                                    id="formData">
                                    <div class="form-group summerNote">
                                        <textarea class="form-control" name="content" id="content"
                                            rows="4"><%- contentData %></textarea>

                                        <p class="text-danger" id="summerText"></p>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="searchbox float-right">
                                            <div class="form-group has-search">
                                                <button type="button" class="btn btn-success" id="saveBtn"> Update
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <%- include('footer') %>
        
            <!-- summernote js -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote-bs4.js"></script>


            <script>
                $(document).ready(function () {
                    $('textarea#content').summernote({
                        placeholder: 'Type here...',
                        tabsize: 2,
                        height: 100,
                        toolbar: [
                            ['style', ['style']],
                            ['font', ['bold', 'italic', 'underline', 'clear']],
                            // ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                            //['fontname', ['fontname']],
                            // ['fontsize', ['fontsize']],
                            ['color', ['color']],
                            ['para', ['ul', 'ol', 'paragraph']],
                            ['height', ['height']],
                            ['table', ['table']],
                            ['insert', ['link', 'hr']],
                            //['view', ['fullscreen', 'codeview']],
                            ['help', ['help']]
                        ],
                    });

                    $("#content").summernote();
                    $('.dropdown-toggle').dropdown();

                    $('#saveBtn').click(function () {

                        $("#formData").validate({
                            rules: {
                                "content": {
                                    required: true,
                                    minlength: 5,
                                }
                            },
                            messages: {
                                "content": {
                                    required: "Terms & conditions field is required.",
                                }
                            },
                        });


                        if ($('#formData').valid() === false) {
                            return false;
                        }


                        // This was made for summernote validation
                        var content = $("#content").val();
                        if (content.length == 0) {
                            $("#summerText").html("Terms & conditions field is required.");
                            return false;
                        } else {
                            $("#summerText").html('');
                        }

                        $.ajax({
                            type: "post",
                            url: `/update-static-page-content`,
                            data: { "pageType": "term_and_condition", "content": content },
                            dataType: 'JSON',
                            beforeSend: function () {
                                $("#processImg").show();
                                $(".loaderShow").show();
                            },
                            complete: function () {
                                $("#processImg").hide();
                                $(".loaderShow").hide();
                            },
                            success: function (response) {
                                if (response.status == "success") {
                                    toastr.remove();
                                    toastr.success(response.message);
                                    window.setTimeout(function () {
                                        window.location.reload();;
                                    }, 1000);
                                }
                            },
                            error: function (response) {
                                let errorResponse = JSON.parse(response.responseText)
                                toastr.remove();
                                toastr.error(errorResponse.message);
                            }
                        });
                    })


                    const trimContentFunction = () => {
                        const values = document.getElementById("content").value;
                        const trimed = values.trim();
                        document.getElementById("content").value = trimed;
                    }

                });
            </script>